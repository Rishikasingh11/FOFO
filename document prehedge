Certificate and Key Creation Process (Pre-Hedging API)
1. Login to CyberArk and Connect to Remote Server
1. Open CyberArk application.
2. Connect to the target server via SSH session.
3. Once connected, switch to the prehedge user account:
   sudo su-prehedge
2. Navigate to Configuration Directory
1. Go to the prehedge_api/config folder:
   cd /prehedge_api/config
2. Create a new folder with today’s date (format: YYYYMMDD). Example:
   mkdir 20250925
3. Move into the new folder:
   cd 20250925
3. Copy and Rename Configuration File
1. List available files:
   ll
2. Copy the csr_config.conf into the new folder:
   cp csr_config.conf 20250925/
3. Go inside the new folder:
   cd 20250925
4. Rename the copied config file:
   mv csr_config.conf csr_prehedge_dev_config.conf
4. Generate Certificate Signing Request (CSR) and Key
1. Run the OpenSSL command to generate key and CSR:
   openssl req -config csr_prehedge_dev_config.conf \
   -new -keyout prehedging-dev.lu.world.socgen.key \
   -out prehedging-dev.lu.world.socgen.csr

   - .key → Private Key file
   - .csr → Certificate Signing Request

2. Password Prompt
- During CSR/Key generation, you may be asked for a password.
- To find the correct password:
   cd /prehedge_api/script
   cat start-prehedging-api.sh
- Inside this script, you will find the password.
- Usually, the pre-hedging application password is: pre-hedge (all small letters).

3. After the command runs, verify CSR content:
   cat prehedging-dev.lu.world.socgen.csr
   The CSR should display starting with:
   -----BEGIN CERTIFICATE REQUEST----- ... -----END CERTIFICATE REQUEST-----
5. Submit CSR on DoItNow Portal
1. Copy the CSR output.
2. Open the DoItNow portal.
3. Click on Import or Generate.
4. Fill in the required details.
   - For the email field, provide the given official email ID.
5. Click Submit.
6. After submission, there will be an option for Generate.
   - Clicking this will generate the required certificate files.


Check and Update Script Path

Ensure the application script points to the new certificate, not the old one.

Go to the scripts folder.

Open bi start-prehedging-api.sh using vi editor.

Change the path to the new certificate (e.g., /20250925).

Do not change anything else in the script.

Save changes (Ctrl + S) and exit the editor.

Restart Server and Verify

Stop the server before making any changes.

After editing, start the server using . start-prehedging-api.sh.

Check if the server is running and verify that the application works correctly.

Note: Always ensure the correct file paths and names before starting the server to avoid issues.



Step: Upload Certificate File via WinSCP

Open WinSCP and connect to the remote server (do not use SSH this time).

In WinSCP, there are two panels: left (local) and right (remote).

On the right (remote) side, go to the home folder → TMP.

Create a new folder with your name inside TMP. Set permissions 777 (read, write, execute all).

On the left (local) side, go to Downloads → Users → [Your Account] → YC → Users → [Your Name] → Downloads.

Locate the downloaded certificate file (pre-hedging-dev.yl).

Drag and drop this file from the left panel to the folder you created on the right panel inside TMP.

Switch to the remote server. Navigate to your new folder (e.g., 20250925).

Copy the PEM file using:

cp /tmp/[your-name]/pre-h<TAB>


Give full access to all files in the folder:

chmod 777 *


Now all files have the correct permissions















1. Backup (Preparation)

Description: Backup existing certificates and configs.

Long Description:

mkdir -p /backup/certificates/$(date +%Y%m%d)
cp /path/to/current/certs/* /backup/certificates/$(date +%Y%m%d)/


Verify backup has .pem, .key, .p12, and config scripts.

2. Implementation

Description: Deploy new certificates and update configurations.

Long Description (Step-by-Step with Commands):

a) Login & Setup

# Login to CyberArk → connect to server via SSH
sudo su - prehedge
cd /prehedge_api/config
mkdir 20250925
cd 20250925


b) Copy Config & Generate CSR + Key

cp ../csr_config.conf ./csr_prehedge_dev_config.conf

openssl req -config csr_prehedge_dev_config.conf \
-new -keyout prehedging-dev.lu.world.socgen.key \
-out prehedging-dev.lu.world.socgen.csr


.key = private key

.csr = certificate signing request

c) Verify CSR Content

cat prehedging-dev.lu.world.socgen.csr


d) Submit CSR on DoItNow Portal

Copy CSR output → Import → Fill details → Submit → Generate.

Download generated .pem certificate.

e) Upload PEM via WinSCP

Connect with WinSCP (not SSH).

Remote path: /home/tmp/<yourname> (create folder with 777 permission).

Local path: Downloads → Users → YC → Users → <YourName> → Downloads.

Drag & drop downloaded .pem to remote folder.

f) Copy PEM to Cert Path

cp /tmp/<yourname>/pre-hedging-dev.pem /path/to/prod/certs/
chmod 777 /path/to/prod/certs/*


g) Generate P12 File

openssl pkcs12 -export -in pre-hedging-dev.pem \
-inkey prehedging-dev.lu.world.socgen.key \
-out prehedging-dev.p12


(Check filenames before executing)

h) Update Script Path

cd /prehedge_api/script
vi start-prehedging-api.sh
# Update cert path → /20250925
# Save & exit

3. Post-Execution (Validation)

Description: Restart server & validate.

Long Description:

./stop-prehedging-api.sh
./start-prehedging-api.sh


Confirm server is running.

Validate application & data flow. (Mobina to do sanity check).

4. Rollback

Description: Restore old certs if issues occur.

Long Description:

./stop-prehedging-api.sh
cp /backup/certificates/<backup-date>/* /path/to/prod/certs/
vi start-prehedging-api.sh   # point back to old cert path
./start-prehedging-api.sh


Validate app with old certificate.

Notify stakeholders rollback executed.
