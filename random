// Helper: Format number with thousand separators and 2 decimals (e.g., 84,380.21)
const formatNumber = (num) => {
  const numberValue = Number(num) || 0;
  return new Intl.NumberFormat("en-US", { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(numberValue);
};



  // Only include Back Office (B) rows
    const boDeals = selectedDeals2.filter(deal => ((deal.type || '').split(' ').includes('B')));
    if (boDeals.length === 0) return { montantAchat: 0, montantVendu: 0, montantBaseAchat: 0, montantBaseVendu: 0 };


 const totals = boDeals.reduce((acc, deal) => {
      const montantAchat = parseFloat(deal.montantAchat?.replace(/[^\d.,]/g, "").replace(",", ".")
      ) || 0;
      const montantVendu = parseFloat(deal.montantVendu?.replace(/[^\d.,]/g, "").replace(",", ".")
      ) || 0;
      const montantBaseAchat = parseFloat(deal.montantBaseAchat?.replace(/[^\d.,]/g, "").replace(",", ".")
      ) || 0;
      const montantBaseVendu = parseFloat(deal.montantBaseVendu?.replace(/[^\d.,]/g, "").replace(",", ".")
      ) || 0;
      return {
        montantAchat: acc.montantAchat + montantAchat,
        montantVendu: acc.montantVendu + montantVendu,
        montantBaseAchat: acc.montantBaseAchat + montantBaseAchat,
        montantBaseVendu: acc.montantBaseVendu + montantBaseVendu
      };
    }, { montantAchat: 0, montantVendu: 0, montantBaseAchat: 0, montantBaseVendu: 0 });




 montantAchat: formatNumber(calculateTotal2()?.montantAchat || 0),
            montantVendu: formatNumber(calculateTotal2()?.montantVendu || 0),



  montantBaseAchat: formatNumber(calculateTotal2()?.montantBaseAchat || 0),
            montantBaseVendu: formatNumber(calculateTotal2()?.montantBaseVendu || 0),

                                                                                                                                                                                                                                 














 <span className="amount-highlight-total">

 // Highlight only for first FO row (slot1) and TOTAL row
        const shouldHighlight = params.data.id === "slot1" || params.data.isTotalRow;
        return (
          <span className={shouldHighlight ? "amount-highlight" : ""}>
            {amount}
          </span>
        );
      },



  <span className="amount-highlight-total">

// Highlight only for first FO row (slot1) and TOTAL row
        const shouldHighlight = params.data.id === "slot1" || params.data.isTotalRow;
        return (
          <span className={shouldHighlight ? "amount-highlight" : ""}>
            {amount}
          </span>
        );
      },



<span className="amount-highlight-total">
 // Highlight only for first FO row (slot1) and TOTAL row
        const shouldHighlight = params.data.id === "slot1" || params.data.isTotalRow;
        return (
          <span className={shouldHighlight ? "amount-highlight" : ""}>
            {params.value}
          </span>
        );
      },


<span className="amount-highlight-total">


  // Highlight only for first FO row (slot1) and TOTAL row
        const shouldHighlight = params.data.id === "slot1" || params.data.isTotalRow;
        return (
          <span className={shouldHighlight ? "amount-highlight" : ""}>
            {params.value}
          </span>
        );




/* Highlight styling for amount columns in first FO row and Total 2 row */
.amount-highlight {
  background-color: #eec2a0 !important;
  padding: 2px 6px !important;
}

.amount-highlight-total {
  background-color: #f9c69f !important;
  padding: 2px 6px !important;
  font-weight: bold !important;
  color: #000000 !important;
}





// Helper: Check if BO row field differs from FO row
  const shouldHighlightDiff = (params, fieldName) => {
    if (!selectedDeal1) return false;
    
    // Check if this is a BO row in the second grid
    const typeParts = (params.data.type || "").split(" ");
    const isBORow = typeParts.includes("B");
    if (!isBORow) return false;
    
    const foValue = selectedDeal1[fieldName];
    const boValue = params.data[fieldName];
    
    if (fieldName === 'montantAchat' || fieldName === 'montantVendu') {
      const foParsed = parseAmountParts(foValue);
      const boParsed = parseAmountParts(boValue);
      
      if (fieldName === 'montantAchat') {
        const shouldHighlight = foParsed.currency !== boParsed.currency || foParsed.n !== boParsed.n;
        console.log(`MontantAchat comparison: FO(${foParsed.currency},${foParsed.n}) vs BO(${boParsed.currency},${boParsed.n}) = ${shouldHighlight}`);
        return shouldHighlight;
      } else {
        const shouldHighlight = foParsed.currency !== boParsed.currency || foParsed.n !== boParsed.n;
        console.log(`MontantVendu comparison: FO(${foParsed.currency},${foParsed.n}) vs BO(${boParsed.currency},${boParsed.n}) = ${shouldHighlight}`);
        return shouldHighlight;
      }
    }
    
    const shouldHighlight = foValue !== boValue;
    console.log(`${fieldName} comparison: FO(${foValue}) vs BO(${boValue}) = ${shouldHighlight}`);
    return shouldHighlight;
  };





 // Highlight differences for BO rows (slot2-*)
        const shouldHighlight = params.data.id.startsWith('slot2-') && selectedDeal1 && 
          (parseAmountParts(selectedDeal1.montantAchat).currency !== currency);
        return (
          <span className={shouldHighlight ? "bo-diff-highlight" : ""}>
            {currency}
          </span>
        );


 // Highlight differences for BO rows (slot2-)
        const shouldHighlight = params.data.id.startsWith('slot2-') && selectedDeal1 && 
          (parseAmountParts(selectedDeal1.montantAchat).n !== n);
        return (
          <span className={shouldHighlight ? "bo-diff-highlight" : ""}>
            {n}
          </span>
        );



 // Highlight differences for BO rows (slot2-*)
        const shouldHighlight = params.data.id.startsWith('slot2-') && selectedDeal1 && 
          (parseAmountParts(selectedDeal1.montantVendu).currency !== currency);
        return (
          <span className={shouldHighlight ? "bo-diff-highlight" : ""}>
            {currency}
          </span>
        );



 // Highlight differences for BO rows (slot2-)
        const shouldHighlight = params.data.id.startsWith('slot2-') && selectedDeal1 && 
          (parseAmountParts(selectedDeal1.montantVendu).n !== n);
        return (
          <span className={shouldHighlight ? "bo-diff-highlight" : ""}>
            {n}
          </span>
        );



  // Highlight differences for BO rows (slot2-*)
        const shouldHighlight = params.data.id.startsWith('slot2-') && selectedDeal1 && 
          (selectedDeal1.coursClient !== params.value);
        return (
          <span className={shouldHighlight ? "bo-diff-highlight" : ""}>
            {params.value}
          </span>
        );



// Highlight differences for BO rows (slot2-*)
        const shouldHighlight = params.data.id.startsWith('slot2-') && selectedDeal1 && 
          (selectedDeal1.coursBase !== params.value);
        return (
          <span className={shouldHighlight ? "bo-diff-highlight" : ""}>
            {params.value}
          </span>
        );



